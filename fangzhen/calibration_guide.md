# 四轴飞行器参数测量与校准指南

本指南帮助您测量和校准实际四轴飞行器的物理参数，以确保仿真结果能够准确应用到实际飞行器上。

## 1. 机体物理参数测量

### 1.1 质量测量
- **工具需求**：精确电子秤（精度至少1g）
- **测量步骤**：
  1. 安装所有必要组件（电池、电机、螺旋桨、控制板等）
  2. 将飞行器放在电子秤上测量总重量
  3. 记录质量（单位：kg）

### 1.2 臂长测量
- **定义**：从机体几何中心到电机转轴中心的距离
- **测量方法**：
  1. 对于X型布局，测量对角电机中心的距离
  2. 臂长 = 对角距离 / (2 × √2)
  3. 或直接测量中心到电机的直线距离
- **单位**：米（m）

### 1.3 转动惯量测量

#### 方法1：CAD模型计算（推荐）
如果有3D模型：
1. 在CAD软件中设置正确的材料密度
2. 使用软件的质量属性工具计算转动惯量
3. 注意坐标系定义要与飞控一致

#### 方法2：悬挂法（实验测量）
**测量绕X轴（Roll）的转动惯量**：
1. 用细线将飞行器从前后两个电机位置悬挂
2. 给飞行器一个小的初始角度，使其做摆动
3. 测量摆动周期T
4. 计算：Ixx = (m × g × d × T²) / (4π²)
   - m：飞行器质量
   - g：重力加速度（9.81 m/s²）
   - d：悬挂点到重心的距离

**测量绕Y轴（Pitch）的转动惯量**：
- 从左右两个电机位置悬挂，重复上述过程

**测量绕Z轴（Yaw）的转动惯量**：
- 从机体中心垂直悬挂，测量扭转振荡

#### 方法3：简化估算
对于对称的X型四旋翼：
- Ixx ≈ Iyy ≈ (2 × m_motor × L²) / 3 + m_center × (L/3)²
- Izz ≈ (4 × m_motor × L²) / 3 + m_center × (L/2)²
  - m_motor：单个电机质量
  - m_center：中心部分质量
  - L：臂长

## 2. 电机参数标定

### 2.1 推力-PWM关系测试

**需要设备**：
- 推力测试台（或自制：电子秤+固定支架）
- PWM信号发生器（或使用飞控输出）

**测试步骤**：
1. 固定单个电机在测试台上
2. 从最小PWM（1000μs）逐步增加到最大PWM（2000μs）
3. 每隔50-100μs记录一次推力读数
4. 绘制推力-PWM曲线

**数据拟合**：
通常推力与PWM呈二次关系：
```
推力(N) = a × (PWM - 1000)² + b
```
使用最小二乘法拟合得到系数a和b。

### 2.2 偏航力矩系数测量

**方法1：扭矩传感器法**
1. 固定电机，使其只能产生扭矩
2. 测量不同推力下的反扭矩
3. 计算比值：k = 扭矩 / 推力

**方法2：自由旋转法**
1. 将飞行器悬挂，使其可以自由偏航
2. 只驱动对角两个同向旋转的电机
3. 测量偏航角加速度
4. 通过 τ = I × α 计算力矩
5. 除以总推力得到系数

**典型值范围**：1.0e-3 到 2.0e-3 N·m/N

### 2.3 电机响应时间常数

**测试方法**：
1. 给电机一个阶跃PWM输入
2. 使用高速摄像或光电传感器记录转速变化
3. 找到达到63.2%稳态值的时间，即为时间常数τ

**典型值**：0.02-0.05秒

## 3. 空气动力参数

### 3.1 阻力系数测试（可选）

**简化方法**：
1. 让飞行器在无风环境下垂直下降
2. 测量终端速度
3. 通过力平衡计算阻力系数

**经验值**：
- 水平方向（x,y）：0.1-0.2 N/(m/s)
- 垂直方向（z）：0.2-0.3 N/(m/s)

## 4. 参数配置文件示例

创建 `my_quad_params.py`：

```python
from fangzhen.unified_params import UnifiedQuadParams

# 我的四轴飞行器参数
MY_QUAD_PARAMS = UnifiedQuadParams(
    # 实测机体参数
    mass=1.35,              # 实测质量
    arm_length=0.225,       # 实测臂长
    
    # 转动惯量（CAD计算或实测）
    inertia_xx=0.0182,
    inertia_yy=0.0183,
    inertia_zz=0.0321,
    
    # 电机参数（推力测试结果）
    motor_thrust_coeff=8.5e-6,
    motor_thrust_offset=0.05,
    motor_thrust_max=8.2,
    
    # 偏航力矩系数（实测）
    yaw_moment_coeff=1.8e-3,
    
    # 其他参数保持默认或根据实际调整
)
```

## 5. 验证步骤

1. **静态验证**：
   - 计算悬停PWM：`hover_pwm = thrust_to_pwm(mass × g / 4)`
   - 与实际悬停油门对比，误差应在±50μs内

2. **动态验证**：
   - 使用相同的PID参数在仿真和实际飞行器上测试
   - 对比阶跃响应和稳定性

3. **迭代优化**：
   - 根据实际飞行表现微调参数
   - 特别关注推力曲线和时间常数

## 6. 常见问题

**Q: 没有专业设备怎么办？**
A: 可以使用简化方法：
- 用厨房秤测推力（注意保护）
- 用视频分析软件测量周期
- 参考同类飞行器的典型参数

**Q: 参数不准确会有什么影响？**
A: 
- 质量/推力不准：影响高度控制
- 转动惯量不准：影响姿态响应速度
- 臂长不准：影响控制分配效率

**Q: 如何知道参数是否合理？**
A: 
- 悬停油门应在40-60%范围
- 最大推重比应在2:1到3:1之间
- 转动惯量比值通常：Izz ≈ 2×Ixx ≈ 2×Iyy
